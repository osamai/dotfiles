#!/bin/sh

if [ $# -lt 2 ]; then
	printf "usage:\n\t%s files... message" "$0"
	exit 1
fi

for msg in "$@"; do :; done

for f in "$@"; do
	[ "$f" = "$msg" ] && continue

	[ "$files" ] && files="$files $f" || files="$f"

	case "$f" in .*) n=$(echo "$f" | cut -c2-) ;; esac

	n=$(echo "$f" | cut -d '.' -f 1 | sed 's:/*$::')

	case "$n" in
		"pkg/"* | "internal/"*) n=$(echo "$n" | cut -d '/' -f 2-) ;;
		"cmd/"*)
			n=$(echo "$n" | cut -d '/' -f 2-)
			[ "$(basename "$n")" = "main" ] && n=$(dirname "$n")
			;;
		"migrations/"*)
			pn=$(basename "$n" | cut -d '_' -f 1)
			[ "$pn" -eq "$pn" ] && n="$(dirname "$n")/$(basename "$n" | cut -d '_' -f 2-)"
			;;
	esac

	dn=$(echo "$n" | cut -d '/' -f 2)
	[ "$(echo "$n" | cut -d '/' -f 1)" = "$dn" ] && n="$dn"

	[ "$names" ] && names="$names, $n" || names="$n"
done

git add $files && git commit -m "$names: $msg"
